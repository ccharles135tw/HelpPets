@model IEnumerable<qqqq.ViewModels.CShoppingCart>
<h1>購物車</h1>

<p>
    <a class="btn btn-primary" asp-action="Shopping">前往產品列表</a>
</p>
    <table class="table  ">
        <thead>
            <tr>
                <th hidden>
                    @Html.DisplayNameFor(model => model.CartId)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CartPhoto)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CartName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CartPrice)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CartCount)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.TotalPrice)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @{
                if (Model.Count() == 0)
                {
                    <tr>
                        <td colspan="6">
                                        <h3>
                                            購物車尚無商品
                                            <a href="~/shopping/shopping" class="btn-primary p-2" style="color:#fff;border-radius:10px;"><i class="fa-solid fa-circle-right">前去購物</i></a>
                                        </h3>
                            <h5> </h5>
                        </td>
                    </tr>
                }
            }
            @foreach (var item in Model)
            {
                if (item.CartCount != 0)
                {
                    <tr>
                        <td hidden>
                            @Html.DisplayFor(modelItem => item.CartId)
                        </td>
                        <td>
                            <img width="100" height="100" src="~/Images/@item.CartPhoto" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CartName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CartPrice)
                        </td>
                        <td>
                            <input type="number" min="1" value="@item.CartCount" onchange="ChangeItemCount('@item.CartId',this.value,false)" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.TotalPrice)
                        </td>
                        <td>

                            <button class="btn btn-warning"><i class="fa-regular fa-eye"></i>@Html.ActionLink("檢視商品", "showproduct", new { id = item.CartId })</button> |
                            <button class="btn btn-danger" onclick="ChangeItemCount('@item.CartId',0,false)"><i class="fa-solid fa-trash-can"></i> 刪除</button>
                        </td>
                    </tr>
                }
                if (item.Donate != 0)
                {

                    <tr>
                        <td hidden>

                            @Html.DisplayFor(modelItem => item.CartId)
                        </td>
                        <td>
                            <img width="100" height="100" src="~/Images/@item.CartPhoto" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CartName)
                            <label class="alert-danger"><i class="fa-solid fa-hand-holding-heart">捐贈</i></label>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CartPrice)
                        </td>
                        <td>
                            <input type="number" min="1" value="@item.Donate" onchange="ChangeItemCount('@item.CartId',this.value,true)" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.DonatePrice)
                        </td>
                        <td>

                            <label class="btn btn-warning"><i class="fa-regular fa-eye"></i>@Html.ActionLink("檢視商品", "showproduct", new { id = item.CartId })</label> |
                            <button class="btn btn-danger" onclick="ChangeItemCount('@item.CartId',0,true)"><i class="fa-solid fa-trash-can"></i> 刪除</button>
                        </td>
                    </tr>
                }
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5" class="text-center "><h5>總價:@(Model.Sum(p => p.TotalPrice)+Model.Sum(p=>p.DonatePrice))</h5></td>
                <td>
                    <a>   @Html.ActionLink("結帳", "Pay", "shopping", new { price = (int)Model.Sum(p => p.TotalPrice) }, new { onclick = "return confirm('確定要結帳嗎?')", @class = "btn btn-success" })</a>
                </td>
            </tr>
        </tfoot>
    </table>

