@using Microsoft.AspNetCore.Http;
@using Microsoft.AspNetCore.Mvc;
@using Microsoft.EntityFrameworkCore;
@using prjMVCDemo.vModel;
@using qqqq.Models;
@using qqqq.ViewModels;
@using System;
@using System.Collections.Generic;
@using System.Linq;
@using System.Net;
@using System.Net.Mail;
@using System.Text.Json;

@model IEnumerable<qqqq.ViewModels.CAdoptView>
<div class="container-fluid  py-6 wow fadeIn" data-wow-delay="0.1s" style=" margin-bottom: 6rem; background: linear-gradient(rgba(0, 0, 0, .3), rgba(0, 0, 0, .3)),url(../img/head-1.jpg) center center no-repeat; background-size: cover;">
    <div class="container text-center pt-5 pb-3">
        <h1 class="display-4 text-white animated slideInDown mb-3">領養中心</h1>
    </div>
</div>
@{
    ViewData["Title"] = "petsList";
    qqqq.Models.我救浪Context db = new 我救浪Context();
    CLoginViewModel memberview = null;
    if (Context.Session.Keys.Contains(CDictionary.SK_LOGIN_USER))
    {
        var b = Context.Session.GetString((CDictionary.SK_LOGIN_USER));
        memberview = JsonSerializer.Deserialize<CLoginViewModel>(b);
    }
    var user = db.Members.Where(m => m.MemberId == 1).FirstOrDefault();
}

<div class="filter-bar flex-wrap align-items-center text-center vw-100" style="justify-content:center;align-items:center">
    <div class="text-center" style="display: flex;flex:none; justify-content: flex-start; align-items: center;padding-top:10px">
        @*style="flex:none;font-size:20px;text-align:center;display:flex;justify-content:center;align-content:center"*@
        <form style="flex: none; width: 50%; align-items: center;padding-left:0;" id="formSearch">
            <label>種類:</label>
            <select id="petCate" class="btn btn-primary" aria-label=".form-select example" name="categoryid">
                <option value="none">請選擇選項</option>
                @{
                    var qp = from c in db.Categories where c.IsPet == true select c;
                    foreach (Category c in qp)
                    {
                        <option style="border:2px solid rgba(246,135,4,0.5)" value="@c.CategoryId">@c.CategoryName</option>
                    }
                }
            </select>

            <label>品種:</label>
            <select id="petSubcate" class="btn btn-primary" aria-label=".form-select example" name="SubCategoryId">
                <option value="none" selected disabled hidden>請選擇選項</option>
            </select>
            <label>性別:</label>
            <select class="btn btn-primary" aria-label=".form-select example" name="GenderId">
                <option value="none" selected disabled hidden>請選擇選項</option>
                @{
                    var qg = from g in db.Genders select g;
                    foreach (Gender g in qg)
                    {
                        <option value="@g.GenderId">@g.GenderType</option>
                    }
                }
            </select>
            <label>體型:</label>
            <select class="btn btn-primary " aria-label=".form-select example" name="SizeId">
                <option value="none" selected disabled hidden>請選擇選項</option>
                @{
                    var qs = from s in db.Sizes select s;
                    foreach (Size s in qs)
                    {
                        <option value="@s.SizeId">@s.SizeType</option>
                    }
                }
            </select>
            <button type="button" id="btnSearch" class="btn btn-primary pl-3">查詢</button>
        </form>

        <div style="flex:none;width:25%" justify-content: flex-start; align-items: center;>
            <form method="post" id="formKeyword">
                <label>關鍵字</label><input type="text" name="keyword" />
                <button type="button" class="btn btn-primary" id="btnKeyword">搜尋</button>
            </form>
        </div>

        <div style="flex: none; width: 25%;justify-content: flex-end; align-items: center;">
            <div class="sorting mr-auto">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">會員願望清單</button>
                @*<button type="button" id="listRow" style="margin-left: 10px; border-color: rgba(246,135,4,0.5);"><i class="fa-solid fa-bars" style="color: rgb(246,135,4);"></i></button>
                <button type="button" id="listCol" style="margin-left: 10px; border-color: rgba(246,135,4,0.5);"><i class="fa-solid fa-table-cells" style="color: rgb(246,135,4);"></i></button>*@
            </div>
            <div>
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">配對條件</h5>
                                <button type="button" class="close border-0" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    <label>種類:</label><select id="petCatel" class="sorting mr-auto btn btn-warning dropdown-toggle" style="margin-left: 10px; margin-right: 10px;">
                                        <option value="none" selected disabled hidden>請選擇選項</option>
                                        @{
                                            var qpl = from p in db.Categories where p.IsPet == true select p;
                                            foreach (Category p in qpl.ToList())
                                            {
                                                if(user.MemberWish==null? false:(p.CategoryId==user.MemberWish.CategoryId))
                                                {
                                                    <option value="@p.CategoryId" selected>@p.CategoryName</option>
                                                }
                                                else
                                                {
                                                    <option value="@p.CategoryId">@p.CategoryName</option>
                                                }
                                                
                                            }
                                        }
                                    </select>
                                </div>
                                <div>
                                    <label>品種:</label><select id="petSubcatel" name="SubCategoryId" class="sorting mr-auto btn btn-warning dropdown-toggle" style="margin-left: 10px; margin-right:10px;">
                                        <option value="none" selected disabled hidden>請選擇選項</option>
                                        @{
                                            var subcategories = db.SubCategories.ToList();
                                            foreach ( SubCategory s in subcategories.ToList())
                                            {
                                                if (user.MemberWish == null ? false : (s.SubCategoryId == user.MemberWish.SubCategoryId))
                                                {
                                                    <option value="@s.SubCategoryId" selected>@s.SubCategoryName</option>
                                                }
                                                else
                                                {
                                                    <option value="@s.SubCategoryId">@s.SubCategoryName</option>
                                                }

                                            }
                                        }
                                    </select>
                                </div>
                                <div class="text-center">
                                    性別: <select class="sorting mr-auto btn btn-warning dropdown-toggle" name="GenderId" style="margin-left: 10px; margin-right:10px;">
                                            <option value="none" selected disabled hidden>請選擇選項</option>
                                                @{
                                                    var gender = db.Genders.ToList();
                                                    foreach (Gender p in gender)
                                                    {
                                                        if (user.MemberWish == null ? false : (p.GenderId == user.MemberWish.GenderId))
                                                        {
                                                            <option value="@p.GenderId" selected>@p.GenderType</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@p.GenderId">@p.GenderType</option>
                                                        }

                                                    }
                                                }
                                          </select>
                                </div>
                                <div>
                                    毛色: <select class="sorting mr-auto btn btn-warning dropdown-toggle" name="ColorId" style="margin-left: 10px; margin-right:10px;">
                                            <option value="none" selected disabled hidden>請選擇選項</option>
                                            @*@{
                                                var color = db.Colors.ToList();
                                                foreach (Color c in color)
                                                {
                                                    if (user.MemberWish == null ? false : (c.ColorId == user.MemberWish.))
                                                    {
                                                        <option value="@c.GenderId" selected>@c.GenderType</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@c.GenderId">@c.GenderType</option>
                                                    }

                                                }
                                            }*@
                                            @*@{
                                                var qcl = from c in db.Colors select c;
                                                foreach (Color c in qcl)
                                                {
                                                    <option value="@c.ColorId">@c.ColorName</option>
                                                }
                                            }*@
                                        </select>
                                </div>
                                <div>
                                    結紮: <select class="sorting mr-auto btn btn-warning dropdown-toggle" name="LigationId" style="margin-left: 10px; margin-right:10px;">
                                            <option value="none" selected disabled hidden>請選擇選項</option>
                                            @{
                                                var ligation = db.Ligations.ToList();
                                                foreach (Ligation l in ligation)
                                                {
                                                    if (user.MemberWish == null ? false : (l.LigationId == user.MemberWish.LigationId))
                                                    {
                                                        <option value="@l.LigationId " selected>@l.LigationType</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@l.LigationId ">@l.LigationType</option>
                                                    }

                                                }
                                            }
                                            @*@{
                                                    var qll = from l in db.Ligations select l;
                                                    foreach (Ligation l in qll)
                                                    {
                                                        <option value="@l.LigationId">@l.LigationType</option>
                                                    }
                                                }*@
                                        </select>
                                </div>
                                <div>
                                    體型: <select class="sorting mr-auto btn btn-warning dropdown-toggle" name="SizeId" style="margin-left: 10px; margin-right:10px;">
                                        <option value="none" selected disabled hidden>請選擇選項</option>
                                       @{
                                                var size = db.Sizes.ToList();
                                                foreach (Size z in size)
                                                {
                                                    if (user.MemberWish == null ? false : (z.SizeId == user.MemberWish.SizeId))
                                                    {
                                                        <option value="@z.SizeId " selected>@z.SizeType</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@z.SizeId ">@z.SizeType</option>
                                                    }

                                                }
                                            }
                                    </select>
                                </div>
                                <div>
                                    年齡層: <select class="sorting mr-auto btn btn-warning dropdown-toggle" name="AgeId" style="margin-left: 10px; margin-right:10px;">
                                        <option value="none" selected disabled hidden>請選擇選項</option>
                                   @{
                                                var age = db.Ages.ToList();
                                                foreach (Age e in age)
                                                {
                                                    if (user.MemberWish == null ? false : (e.AgeId == user.MemberWish.AgeId))
                                                    {
                                                        <option value="@e.AgeId " selected>@e.AgeType</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@e.AgeId ">@e.AgeType</option>
                                                    }

                                                }
                                            }
                                    </select>
                                </div>
                                <div>
                                    區域: <select class="sorting mr-auto btn btn-warning dropdown-toggle" style="margin-left: 10px; margin-right:10px;">
                                        <option value="none" selected disabled hidden>請選擇選項</option>
                                     @{
                                                var city = db.Cities.ToList();
                                                foreach (City c in city)
                                                {
                                                    if (user.MemberWish == null ? false : (c.CityId == user.MemberWish.CityId))
                                                    {
                                                        <option value="@c.CityId" selected>@c.CityName</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@c.CityId">@c.CityName</option>
                                                    }

                                                }
                                            }
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer" style="right:0;">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary">@Html.ActionLink("開始配對", "petsMatch", "pets")</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<div class="col-4 w-100" id="divAlert">
    @*@foreach (var p in Model)
        {
            <div class="col-md-10 col-lg-4">
                <div class="card text-center card-product">
                    <div class="card-product__img">
                        <img width="300" height="300" src="/Images/@(p._prod.Photos.Where(ph=>ph.IsDefault==true).Count()==0?null:p._prod.Photos.FirstOrDefault().PictureName)" alt="" style="border:3px solid #EAA636;">
                        <div class="card-product__imgOverlay" style="display:block">
                            <h5 style="color:#000;">性別:<span>@(p.GenderType)</span></h5>
                            <h5 style="color:#000;">體型:<span>@(p.SizeType)</span></h5>
                            <h5 style="color:#000;">年齡層:<span>@(p.AgeType)</span></h5>
                            <h5 style="color:#000;">描述 :@p.Description</h5>
                            <button id="addToList" style=" background: #734226; border: none; border-radius: 10px;">
                                <i class="fa-solid fa-list-alt" style="color:#fff;padding-right:5px;">@Html.ActionLink("詳細資料", "petsDetial", "pets")</i>
                            </button>
                        </div>
                    </div>
                   *<div class="card-body">
                            <p>品種:@p.SubCategoryName</p>
                            <h4 class="card-product__title"><a href="/pets/petsDetial">@p.ProductName</a></h4>

                        </div>
                </div>
            </div>
        }*@
</div>

@section scripts{
    <script>
        const divInfo = document.querySelector("#divAlert");
        $("#divAlert").load('@Url.Content("~/pets/petsPhoto")');
        $("#listRow").click(() => {
            $("#divAlert").load('@Url.Content("~/pets/petsPhotoRow")')
        });
        $("#listCol").click(() => {
            $("#divAlert").load('@Url.Content("~/pets/petsPhoto")')
        });
        $("#petCate,#petCatel").on('change', function () {
            $.getJSON('@Url.Content("~/pets/petsSubcategory")', { "id":this.value}, (data) => {
                let list = JSON.parse(data);
                let select = $("#petSubcate,#petSubcatel")
                select.empty();
                let opt = document.createElement("option");
                opt.value = 0;
                opt.text = "請選擇項目";
                select.append(opt);
                $.each(list, (index, item) => {
                    let opt = document.createElement("option");
                    opt.value = item.SubCategoryId;
                    opt.text = item.SubCategoryName;
                    select.append(opt);
                })
            })
        })
        $("#btnSearch").click(() => {
            $.post('@Url.Content("~/pets/SearchForPet")', $("#formSearch").serialize(), (result) => {
                $("#divAlert").empty();
                //console.log(result)
                $("#divAlert").append(result);
            })
        })

         $("#btnKeyword").click(() => {
            $.post('@Url.Content("~/pets/SearchForKeyword")', $("#formKeyword").serialize(), (result) => {
                $("#divAlert").empty();
                //console.log(result)
                $("#divAlert").append(result);
            })
        })
    </script>

}
